<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assetsDetailCourses/style.css">
    <link rel="stylesheet" href="/assetsDetailCourses/card.css">


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Document</title>
</head>

<body>
    <div class="container">
        <div class="main-product row">
            <div class="col-6">
                <div class="img-main-product">
                    <img class="main-img" src="/images/{{course.tutor.avatar}}" alt="">
                </div>
            </div>

            <div class="col-6 discription-product">
                <!-- <div class="category-product">RUNNING SHOES</div> -->
                <div class="header-product">{{course.tutor.fullname}}-{{course.name}}</div>
                <div class="num-review">
                    <div class="rating">
                        {{course.average}}

                        <div class="star-"></div>
                    </div>
                    ({{amountOfReviews}} Customer Reviews)
                </div>
                <div class="wrapper-price-product">
                    <div class="price-product-current">${{course.discount}}</div>

                    <div class="price-product-origin">$ {{course.price}}</div>

                    <div class="percent-discount">- {{percent course.discount course.price}}%</div>
                </div>

                <div class="discription-product">
                    {{course.description}}
                </div>

                <div class="wrapper-select-schedule">
                    <ul class="list-schedule">
                        {{#each course.schedule}}
                        <li class="schedule">
                            <button class="btn-schedule">
                                {{this}}
                            </button>
                        </li>
                        {{/each}}
                    </ul>
                </div>

                <div class="wrapper-choose-course">
                    <ul class="list-course">
                        {{#each coursesListOfTutor}}
                        <li class="course" onclick="changeCourse('{{this._id}}')">
                            <button class="btn-course">
                                {{this.name}}
                            </button>
                        </li>
                        {{/each}}
                    </ul>
                </div>

                <button class="btn-contact" id="btn-contact">Contact</button>

            </div>
            <div class="wrapper-discription ">
                <!-- handled description: none -->
                {{!-- <div class="row description">
                    <div class="col-6">
                        <div class="text-header">Description</div>
                        <div class="text-content">Keep your home organized, yet elegant with storage cabinets by
                            Onita Patio Furniture. These cabinets not only make a great storage units, but also
                            bring a great decorative accent to your decor. Traditionally designed, they are perfect
                            to be used in the hallway, living room, bedroom, office or any place where you need to
                            store or display things. Made of high quality materials, they are sturdy and durable for
                            years. Bring one-of-a-kind look to your interior with furniture from Onita Furniture!
                        </div>




                    </div>

                    <div class="col-6">
                        <div class="text-header">About This Products</div>
                        <ul class="text-content">
                            <li>Lorem ipsum dolor sit amet, consectetur adipiscing elit.</li>
                            <li>Nulla luctus libero quis mauris vestibulum dapibus.</li>
                            <li>Maecenas ullamcorper erat mi, vel consequat enim suscipit at.</li>
                            <li>Quisque consectetur nibh ac urna molestie scelerisque.</li>
                            <li>Mauris in nisl scelerisque massa consectetur pretium sed et mauris.</li>
                        </ul>
                    </div>
                </div> --}}
                <div class="header relative">Relative Course</div>
                <div class="features">

                    {{#each coursesListOfName}}
                    <div class="feature text-center">

                        <img src="/images/{{this.tutor.avatar}}" onclick="changeCourse('{{this._id}}')" alt="">
                        <div class="text-header">

                        </div>
                        <div class="text-content ">
                            {{this.name}}
                        </div>
                    </div>
                    {{/each }}

                   
                </div>


                <div class="wrapper-review">
                    <div class="header-review">
                        Reviews({{amountOfReviews}})
                    </div>
                    <div class="row reviews">

                        <div class="col-3 ">
                            <div class="wrapper-score-review">
                                <div class="score-review">
                                    {{course.average}}
                                </div>
                                <div class="num-review">
                                    <div class="rating">

                                        <div class="star-1"></div>
                                    </div>


                                </div>
                            </div>
                        </div>

                        <div class="col-9">
                            <ul class="user-reviews">
                                {{#each reviews}}
                                <li class="user-review">
                                    <img alt=""
                                        src="https://secure.gravatar.com/avatar/b992087ca24c735ade838a3cf92d0d29?s=100&amp;d=mm&amp;r=g"
                                        srcset="https://secure.gravatar.com/avatar/b992087ca24c735ade838a3cf92d0d29?s=200&amp;d=mm&amp;r=g 2x"
                                        class="avatar avatar-100 photo" height="100" width="100" loading="lazy"
                                        decoding="async">

                                    <div class="detail-review-user">
                                        <div class="score-rating-user">
                                            <div class="num-review">
                                                {{this.rating}}
                                                <div class="rating">

                                                    <div class="star-1"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="name-user"> {{this.userId.fullname}} </div>
                                        <div class="time-review"> {{this.datePost }}</div>
                                        <div class="content-user-review">
                                            {{this.comment}}
                                        </div>
                                    </div>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="add-review">
                    <div class="header-add-review">Add A Review</div>
                    <div class="sub-instruction">
                        Your email address will not be published. Required fields are marked *
                    </div>
                    <div class="rating-form">
                        <div class="text-rating">Rating:* </div>
                        <div class="rating">
                            <input type="radio" id="star-5" name="rating" value="5">
                            <label for="star-5"></label>
                            <input type="radio" id="star-4" name="rating" value="4">
                            <label for="star-4"></label>
                            <input type="radio" id="star-3" name="rating" value="3">
                            <label for="star-3"></label>
                            <input type="radio" id="star-2" name="rating" value="2">
                            <label for="star-2"></label>
                            <input type="radio" id="star-1" name="rating" value="1">
                            <label for="star-1"></label>

                        </div>
                    </div>


                    <form class="row g-3 needs-review" novalidate>
                        {{!-- <div class="col-md-6">
                            <label for="nameReview" class="form-label"></label>
                            <input type="text" class="form-control" id="nameReview" placeholder="Your name" required>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="emailReview" class="form-label"></label>
                            <input type="text" class="form-control" id="emailReview" placeholder="Your email" required>
                            <div class="valid-feedback">
                                Looks good!
                            </div>
                        </div> --}}

                        <div class="col-md-12">
                            <label for="feedback" class="form-label"></label>

                            <!-- phan van textarea co lay duoc data vo khong -->
                            <!-- <input type="text" class="form-control" id="feedback" placeholder="Your review" rows="4" required> -->
                            <textarea type="text" class="form-control" id="feedback" placeholder="Your review"
                                rows="4"></textarea>
                            <div class="invalid-feedback">
                                Please provide a review.
                            </div>
                        </div>

                        <div class="col-12">
                            <button class="btn btn-primary" id="submit-review" type="submit">Submit form</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card">
                <h1>Card</h1>
                <ul class="listCard">
                </ul>
                <div class="checkOut">
                    <div class="total">0</div>
                    <div class="closeShopping">Close</div>
                </div>
            </div>



            <script>
                const $ = document.querySelector.bind(document)
                const $$ = document.querySelectorAll.bind(document)

                // load courses change
                function changeCourse(id) {
                    window.location.href = `/courses/${id}`
                }



                // handle review

                function getRating() {
                    var ratingElements = $$('.rating-form .rating input');
                    var selectedRating;

                    for (var i = 0; i < ratingElements.length; i++) {
                        if (ratingElements[i].checked) {
                            selectedRating = ratingElements[i].value;
                            break;
                        }
                    }

                    return selectedRating;
                }
                const submitButton = $("#submit-review");

                submitButton.addEventListener("click", async function (event) {

                    event.preventDefault();
                    let isError = false;

                    const numRating = getRating();
                    const feedback = $('#feedback').value

                    const formData = {
                        'rating': numRating,
                        'comment': feedback
                    };
                    const curUrl = window.location.href;
                    const parts = curUrl.split('/');
                    const lastPart = parts[parts.length - 1];
                    console.log(numRating);
                    console.log(`/review/store/${lastPart}`);
                    fetch(`/review/store/${lastPart}`, {
                        method: 'POST',
                        body: JSON.stringify(formData),
                        headers: {
                            'Content-type': 'application/json; charset=UTF-8',
                        },
                    })
                        .then(response => {
                            if (!response.ok) {
                                isError = true;
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log(data)

                            if (isError == true) {
                                alert(data.error);
                            }
                            if (isError == false) {

                                window.location.href = curUrl.toString();
                            }
                        })
                        .catch(error => {
                            console.error('There has been a problem with your fetch operation:', error);

                        });
                });


                // handle contact to Tutor
                const contactButton = $("#btn-contact");

                contactButton.addEventListener("click", async function (event) {
                    event.preventDefault();
                    let isError = false;
                    const curUrl = window.location.href;
                    const parts = curUrl.split('/');
                    const lastPart = parts[parts.length - 1];
                    console.log(`/user/formTutor/${lastPart}`);
                    fetch(`/user/contact/${lastPart}`, {
                        method: 'GET',

                    })
                        .then(response => {
                            if (!response.ok) {
                                isError = true;
                                console.log(response)
                            }
                            return response.json();
                        })
                        .then(data => {
                            console.log(data);

                            if (isError) {
                                alert(data.error);
                            } else {
                                window.location.href = data.msg.toString()
                            }
                        })
                        .catch(error => {
                            console.error('There has been a problem with your fetch operation:', error);
                        });
                });


            </script>


        </div>





        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>
</body>

</html>